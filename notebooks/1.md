# 一、常见面试题

## 1、消息队列有哪些作用

1. 解耦：使用消息队列作为两个系统之间的通信方式，这两个系统就不会互相依赖了。
   
2. 异步：系统给消息队列发完消息后就可以做其他事了
   
3. 流量削峰：如果使用消息队列的方式来调用系统，那么消息在队列中排队，由消费者控制消费速度。

## 2、如何保证消息的高速读写

即：零拷贝，Kafka和RocketMq都是通过零拷贝技术来优化文件读写。

关于零拷贝请百度

Java对Mmap进行了封装，用得是MappedByteBuffer对象操作

同时也对transfile进行了封装，用得是FileChannel

MKmap适合比较小的文件，1.5g-2g之间

而transfile则没有大小限制

RockerMq使用Mmap对文件进行读写。

在Kafka中，他的index日志文件也是通过mmap的方式来读写的，但是kafka是使用transfile的方式将文件加载到网卡的。

## 3、如何保证消息顺序读写

全局有序和局部有序：MQ只需要保证局部有序，而不需要保证全局有序。

生产者把一组有序的消息放在同一个队列中，消费者一次消费整个队列中的信息。

在RocketMq中有完整的设计，但在RabbitMq和Kafka中需要自己进行设计。

### RabbitMq实现

通过exchange的方式，建立消息和Queue的绑定关系，保证目标exchange只对应一个Queue。

对于消费者来说，一个Queue只对应一个消费者

### Kafka实现

在一个Topic保证只能拿到一个Partition，定义一个Partition分配器，发消息分配到一个Partition里。Topic下只对应一个消费者。

## 4、如何进行产品选型

### Kafka

优点：吞吐量非常大，性能非常好，集群高可用

缺点：会丢数据，功能单一，场景单一。

使用场景：数据量大、频繁且允许有小的数据丢失。

### RabbitMq

优点：消息可靠性高，功能全面

缺点：吞吐量低，消息积累严重影响性能，Erlang不方便定制

使用场景：小规模场景。

### RocketMq

优点：高吞吐、高性能、高可用、功能全面

缺点：开源版功能不如商业版，官方文档和生态不够成熟。客户端仅支持Java。

使用场景：几乎全场景。

